-- Drop tables if they exist
DROP TABLE Users;
DROP TABLE Sprints;
DROP TABLE SprintComments;
DROP TABLE Tasks;
DROP TABLE TasksComments;
DROP TABLE Projects;
DROP TABLE ProjectsComments;
DROP TABLE Stories;
DROP TABLE StoriesComments;

-- Make sure that foreign_key support is turned on
PRAGMA foreign_keys = ON;

-- At first, create tables

CREATE TABLE Users (
  id INTEGER PRIMARY KEY,
  login TEXT NOT NULL UNIQUE,
  password TEXT,
  name TEXT
);

CREATE TABLE Sprints(
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,
  start_time TEXT,
  end_time TEXT
);

CREATE TABLE SprintComments(
  id INTEGER PRIMARY KEY,
  сontents TEXT NOT NULL UNIQUE,
  date TEXT,
  userId INTEGER NOT NULL,
  sprintId INTEGER NOT NULL,
  FOREIGN KEY(userId) REFERENCES Users(id),
  FOREIGN KEY(sprintId) REFERENCES Sprints(id)
);

CREATE TABLE Tasks(
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,
  points INTEGER,
  status INTEGER,
  completeness INTEGER
);

CREATE TABLE TasksComments(
  id INTEGER PRIMARY KEY,
  сontents TEXT NOT NULL UNIQUE,
  date TEXT,
  userId INTEGER NOT NULL,
  taskId INTEGER NOT NULL,
  FOREIGN KEY(userId) REFERENCES Users(id),
  FOREIGN KEY(taskId) REFERENCES Sprints(Tasks)
);

CREATE TABLE Projects(
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL UNIQUE
);

CREATE TABLE Stories(
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL UNIQUE
);

-- Create a table for the todos where each todo references the primary key of a user
CREATE TABLE Todos (
  id INTEGER PRIMARY KEY,
  description TEXT,
  userId INTEGER,
  FOREIGN KEY(userId) REFERENCES Users(id)
);


-- Add some users to the users table
INSERT INTO Users(name) VALUES ('John');
INSERT INTO Users(name) VALUES ('Mary');
INSERT INTO Users(name) VALUES ('Alice');
INSERT INTO Users(name) VALUES ('Bob');

-- Add some todos to the todos table
INSERT INTO Todos(description, userId) VALUES ('Buy milk', 1);
INSERT INTO Todos(description, userId) VALUES ('Make coffee', 1);
INSERT INTO Todos(description, userId) VALUES ('Learn Angular', 2);
INSERT INTO Todos(description, userId) VALUES ('Learn Eiffel', 3);
INSERT INTO Todos(description, userId) VALUES ('Enjoy HTML', 4);
INSERT INTO Todos(description, userId) VALUES ('Be happy', 2);
