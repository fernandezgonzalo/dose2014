<div ng-include="'partials/navbar.html'"></div>

<div ng-controller="TaskboardCtrl">
  <div class="container">

    <div class="row">
      <h3>Project: {{ project.name }} - Sprint: {{ sprint.name }}</h3>
    </div>

    <div ng-repeat="userStoryTasks in storiesTasks">
      <div class="row">
        <div class="col-md-2">
          <span class="dropdown" dropdown on-toggle="toggled(open)">
            <a href class="dropdown-toggle" dropdown-toggle>
              <h3>Stories <span class="caret"></span></h3>
            </a>
            <ul class="dropdown-menu">
              <li><a href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/create"><i class="fa fa-plus"></i> Create Story</a></li>
            </ul>
          </span>

          <div id="stream">
            <div class="stream-item">
              <div class="row">
                <div class="stream-panel credits">
                  <ul class="stream-panel-ul">
                    <li><span class="item-title">{{ userStoryTasks.story.title }}</span></li>
                    <li><span class="item-content">{{ userStoryTasks.story.description }}</span></li>
                    <li><span class="item-content">Points: {{ userStoryTasks.story.points }}</span></li>
                    <li><span class="item-content">Notes: {{ userStoryTasks.story.notes }}</span></li>
                    <li>
                      <div class="btn-group">
                        <a  href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/edit/{{userStoryTasks.story.id}}" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</a>
                        <a ng-click='deleteStory(projectId,sprintId,userStoryTasks.story.id)' class="btn btn-default btn-xs"><span class="glyphicon glyphicon-trash"></span> Delete</a>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div> <!-- end stream-item -->
          </div> <!-- end stream -->
        </div> <!-- end collumn -->

        <div class="col-md-2">
          <span class="dropdown" dropdown on-toggle="toggled(open)">
            <a href class="dropdown-toggle" dropdown-toggle>
              <h3>Not Started <span class="caret"></span></h3>
            </a>
            <ul class="dropdown-menu">
              <li><a href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/tasks/create"><i class="fa fa-plus"></i> Create Task</a></li>
            </ul>
          </span>

          <div ng-repeat="task in userStoryTasks.task_Not_Started">
            <div id="stream">
              <div class="stream-item">
                <div class="row">
                  <div class="stream-panel credits">
                    <ul class="stream-panel-ul">
                      <li><span class="item-title">{{ task.description }}</span></li>
                      <li><span class="item-content">Task Point: {{ task.nr }}</span></li>
                      <li>
                        <div class="btn-group">
                          <a ng-href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/task/edit/{{task.id}}" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</a>
                          <a ng-click='deleteTask(projectId,sprintId,userStoryTasks.story.id,task.id)'  class="btn btn-default btn-xs"><span class="glyphicon glyphicon-trash"></span> Delete</a>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div> <!-- end stream-item -->
            </div> <!-- end stream -->
          </div> <!-- end ng repeat -->
        </div> <!-- end column -->

        <div class="col-md-2">
          <span class="dropdown" dropdown on-toggle="toggled(open)">
            <a href class="dropdown-toggle" dropdown-toggle>
              <h3>In Progress <span class="caret"></span></h3>
            </a>
            <ul class="dropdown-menu">
              <li><a href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/tasks/create"><i class="fa fa-plus"></i> Create Task</a></li>
            </ul>
          </span>

          <div ng-repeat="task in userStoryTasks.task_In_Progress">
            <div id="stream">
              <div class="stream-item">
                <div class="row">
                  <div class="stream-panel credits">
                    <ul class="stream-panel-ul">
                      <li><span class="item-title">{{ task.description }}</span></li>
                      <li><span class="item-content">Task Point: {{ task.nr }}</span></li>
                      <li>
                        <div class="btn-group">
                          <a ng-href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/task/edit/{{task.id}}" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</a>
                          <a ng-click='deleteTask(projectId,sprintId,userStoryTasks.story.id,task.id)'  class="btn btn-default btn-xs"><span class="glyphicon glyphicon-trash"></span> Delete</a>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div> <!-- end stream-item -->
            </div> <!-- end stream -->
          </div> <!-- end ng repeat -->
        </div> <!-- end column -->

        <div class="col-md-2">
          <span class="dropdown" dropdown on-toggle="toggled(open)">
            <a href class="dropdown-toggle" dropdown-toggle>
              <h3>Completed<span class="caret"></span></h3>
            </a>
            <ul class="dropdown-menu">
              <li><a href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/tasks/create"><i class="fa fa-plus"></i> Create Task</a></li>
            </ul>
          </span>

          <div ng-repeat="task in userStoryTasks.task_Completed">
            <div id="stream">
              <div class="stream-item">
                <div class="row">
                  <div class="stream-panel credits">
                    <ul class="stream-panel-ul">
                      <li><span class="item-title">{{ task.description }}</span></li>
                      <li><span class="item-content">Task Point: {{ task.nr }}</span></li>
                      <li>
                        <div class="btn-group">
                          <a ng-href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/task/edit/{{task.id}}" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</a>
                          <a ng-click='deleteTask(projectId,sprintId,userStoryTasks.story.id,task.id)'  class="btn btn-default btn-xs"><span class="glyphicon glyphicon-trash"></span> Delete</a>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div> <!-- end stream-item -->
            </div> <!-- end stream -->
          </div> <!-- end repeat -->
        </div> <!-- end column -->

        <div class="col-md-2">
          <span class="dropdown" dropdown on-toggle="toggled(open)">
            <a href class="dropdown-toggle" dropdown-toggle>
              <h3>Blocked<span class="caret"></span></h3>
            </a>
            <ul class="dropdown-menu">
              <li><a href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/tasks/create"><i class="fa fa-plus"></i> Create Task</a></li>
            </ul>
          </span>

          <div ng-repeat="task in userStoryTasks.task_Blocked">
            <div id="stream">
              <div class="stream-item">
                <div class="row">
                  <div class="stream-panel credits">
                    <ul class="stream-panel-ul">
                      <li><span class="item-title">{{ task.description }}</span></li>
                      <li><span class="item-content">Task Point: {{ task.nr }}</span></li>
                      <li>
                        <div class="btn-group">
                          <a ng-href="#/projects/{{projectId}}/sprints/{{sprintId}}/stories/{{userStoryTasks.story.id}}/task/edit/{{task.id}}" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span> Edit</a>
                          <a ng-click='deleteTask(projectId,sprintId,userStoryTasks.story.id,task.id)'  class="btn btn-default btn-xs"><span class="glyphicon glyphicon-trash"></span> Delete</a>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div> <!-- end stream-item -->
            </div> <!-- end stream -->
          </div> <!-- end ng repeat -->
        </div> <!-- end column -->
      </div> <!-- end row -->
    </div> <!-- end ng repeat stories -->

  </div>



  <div ng-controller="ChatCtrl">
    <div class="row chat-window col-xs-5 col-md-3" id="chat_window_1" style="margin-left:50%;">
      <div class="col-xs-12 col-md-12">
        <div class="panel-chat panel-default">
          <div class="panel-heading top-bar">
            <div class="col-md-8 col-xs-8">
              <h3 class="panel-title"><span class="glyphicon glyphicon-comment"></span> Chat - {{user_name}}</h3>
            </div>
            <!--div class="col-md-4 col-xs-4" style="text-align: right;">
            <a href="#"><span id="minim_chat_window" class="glyphicon glyphicon-minus icon_minim"></span></a>
            <a href="#"><span class="glyphicon glyphicon-remove icon_close" data-id="chat_window_1"></span></a>
          </div-->
        </div>
        <div class="panel-body msg_container_base">

          <div class="bubble-container" ng-repeat="m in messages">
            <div class="row msg_container base_sent">
              <div class="col-md-10-chat col-xs-10">
                <div class="messages msg_sent">
                  <p>{{m.text}}</p>
                  <time datetime="2009-11-13T20:00">  {{ m.name }} : • {{m.timestamp}}   </time>
                  <div class="clearfix"></div> 
                  </div>
                </div>
                <div class="col-md-2-chat  col-xs-2 avatar">
                  <img src="http://www.bitrebels.com/wp-content/uploads/2011/02/Original-Facebook-Geek-Profile-Avatar-1.jpg" class=" img-responsive ">
                </div>
              </div>
            </div>

          </div>
          <div class="panel-footer">
            <form name="sendMsgForm" ng-submit="sendMsg(messageText)" accept-charset="UTF-8" class="equal-margins" role="form">

              <div class="input-group">
                <input id="btn-input"  type="text" ng-model="messageText" class="form-control input-sm chat_input" placeholder="Type your message" />
                <span class="input-group-btn">
                  <input type="submit" class="btn btn-primary btn-sm" id="btn-chat" value="Send"  ng-disabled="btn-input.$invalid"/>

                </span>
              </div>
            </from>
          </div>
        </div>
      </div>
    </div>

    <div class="btn-group dropup">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
        <span class="glyphicon glyphicon-cog"></span>
        <span class="sr-only">Toggle Dropdown</span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li><a href="#" id="new_chat"><span class="glyphicon glyphicon-plus"></span> Novo</a></li>
        <li><a href="#"><span class="glyphicon glyphicon-list"></span> Ver outras</a></li>
        <li><a href="#"><span class="glyphicon glyphicon-remove"></span> Fechar Tudo</a></li>
        <li class="divider"></li>
        <li><a href="#"><span class="glyphicon glyphicon-eye-close"></span> Invisivel</a></li>
      </ul>
    </div>
  </div>

</div> <!-- end container -->

</div> <!-- end TaskboardCtrl -->
